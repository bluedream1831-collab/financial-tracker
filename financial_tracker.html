<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è²¡å‹™è‡ªç”±è¿½è¹¤ç³»çµ±ï¼ˆä¿å®ˆä¼°è¨ˆç‰ˆï¼‰| wcj å°ˆå±¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 1.8em;
            color: #667eea;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .editable-card {
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 20px;
            background: white;
            margin-bottom: 15px;
        }
        
        .editable-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        
        input[type="number"] {
            padding: 8px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 5px;
            font-size: 1.1em;
            width: 120px;
            transition: all 0.3s;
        }
        
        input[type="number"]:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            width: 100%;
            min-height: 120px;
            padding: 10px 12px;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
            font-family: inherit;
            font-size: 1em;
            resize: vertical;
            transition: all 0.3s;
        }
        
        textarea:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .summary-item {
            padding: 15px;
            background: #f9fafb;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .summary-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .summary-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .alert-info {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
            color: #1e40af;
        }
        
        .alert-success {
            background: #d1fae5;
            border-left: 4px solid #10b981;
            color: #065f46;
        }
        
        .alert-warning {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            color: #92400e;
        }
        
        .alert-danger {
            background: #fee2e2;
            border-left: 4px solid #ef4444;
            color: #991b1b;
        }
        
        .button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .expense-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .expense-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }
        
        .policy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .policy-item {
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 20px;
            background: #f9fafb;
        }
        
        /* é€²åº¦æ¢æ¨£å¼ */
        .progress-bar-container {
            margin: 15px 0;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }
        
        .progress-bar-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        
        .progress-bar-track {
            width: 100%;
            height: 25px;
            background: #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-bar-fill {
            height: 100%;
            transition: width 0.5s ease-out, background 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }

        /* å€Ÿæ¬¾æ¯”é¡è‰²ç´°ç·»å€åˆ† */
        .ratio-green {
            background: linear-gradient(90deg, #22c55e, #16a34a);
        }
        .ratio-yellowgreen {
            background: linear-gradient(90deg, #a3e635, #65a30d);
        }
        .ratio-yellow {
            background: linear-gradient(90deg, #facc15, #eab308);
        }
        .ratio-orange {
            background: linear-gradient(90deg, #fb923c, #f97316);
        }
        .ratio-red {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }
        
        .margin-info {
            margin-top: 10px;
            padding: 10px;
            background: #f0f9ff;
            border-radius: 6px;
            font-size: 0.9em;
        }
        
        .margin-info.safe {
            background: #d1fae5;
            color: #065f46;
        }
        
        .margin-info.warning {
            background: #fef3c7;
            color: #92400e;
        }
        
        .margin-info.danger {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .total-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .total-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }

        .disaster-info {
            margin-top: 8px;
            padding: 8px;
            background: #f3f4f6;
            border-radius: 6px;
            font-size: 0.85em;
            color: #374151;
        }

        .safety-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.9em;
            font-weight: 600;
        }
        
        @media print {
            body {
                background: white;
            }
            .button {
                display: none;
            }
            input[type="number"], textarea {
                border: none;
                background: transparent;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ¯ è²¡å‹™è‡ªç”±è¿½è¹¤ç³»çµ±ï¼ˆé€²éšç‰ˆ - ä¿å®ˆä¼°è¨ˆï¼‰</h1>
            <div style="color: #666; font-size: 1.2em; margin-top: 10px;">wcj å°ˆå±¬ | 38æ­² â†’ 45æ­²é”æ¨™è¨ˆç•«</div>
            <div style="color: #d97706; font-size: 1em; margin-top: 8px; font-weight: 500;">
                ğŸ“Š å„²è“„æœŸæ¡ç”¨ <strong>5% å¹´åŒ–å ±é…¬</strong>ï¼Œ7å¹´å¾Œæ•´åŒ…è½‰å…¥ <strong>8% é…æ¯å‹åŸºé‡‘</strong>
            </div>
            <div style="color: #999; font-size: 0.95em; margin-top: 5px;">âœ¨ åŠŸèƒ½ï¼šå€Ÿæ¬¾æ¯”é€²åº¦æ¢ + è·ŒæŠ—è¨ˆç®— + è‚¡ç½æ¨¡æ“¬ + å„²è“„â†’é…æ¯è‡ªå‹•è©¦ç®— + è‡ªå„Ÿæ¯” + å®‰å…¨è©•åˆ†</div>
            <div style="margin-top: 15px;">
                <button class="button" onclick="calculateAll()">ğŸ”„ é‡æ–°è¨ˆç®—å…¨éƒ¨</button>
                <button class="button" onclick="window.print()">ğŸ–¨ï¸ åˆ—å°å ±å‘Š</button>
                <button class="button" onclick="saveData()">ğŸ’¾ å„²å­˜æ•¸æ“š</button>
                <button class="button" onclick="loadData()">ğŸ“‚ è¼‰å…¥æ•¸æ“š</button>
                <button class="button" onclick="resetFlexible()">ğŸ§¹ å½ˆæ€§æ”¯å‡ºæ­¸é›¶</button>
            </div>
        </div>

        <!-- è³‡ç”¢èˆ‡è² å‚µ -->
        <div class="section">
            <h2 class="section-title">ğŸ“Š è³‡ç”¢èˆ‡è² å‚µæ˜ç´°ï¼ˆå¯ç·¨è¼¯ï¼‰</h2>
            
            <div class="alert alert-info">
                <strong>ğŸ’¡ ä½¿ç”¨æ–¹å¼ï¼š</strong>ç›´æ¥é»æ“Šæ•¸å­—å³å¯ä¿®æ”¹ï¼ä¿®æ”¹å¾ŒæŒ‰ Enter æˆ–é»æ“Šå…¶ä»–åœ°æ–¹ï¼Œç³»çµ±æœƒè‡ªå‹•é‡æ–°è¨ˆç®—ã€‚<br>
                <strong>ğŸ¯ å€Ÿæ¬¾æ¯”é¡è‰²ï¼š</strong>
                0â€“40%ï¼šç¶  âœ… ï½œ 40â€“60%ï¼šé»ƒç¶ ï½œ60â€“80%ï¼šé»ƒï½œ80â€“90%ï¼šæ©˜ï½œ90%+ï¼šç´… ğŸš¨
            </div>

            <div class="alert alert-warning">
                <strong>âš ï¸ è£œç¹³ç·šèˆ‡æ–·é ­ç·šèªªæ˜ï¼ˆæ›´æ–°ç‰ˆï¼‰</strong><br>
                â€¢ <strong>ä¿å–®Aï¼ˆæ³•å·´å¹´é‡‘å‹ï¼‰</strong>ï¼šå€Ÿæ¬¾æ¯”é” 80% â†’ è­¦æˆ’ / 90% â†’ æ–·é ­ï¼Œ<strong>é€šçŸ¥æ›¸åˆ°é”å¾Œ 5 æ—¥å…§</strong>éœ€é‚„æ¬¾<br>
                â€¢ <strong>ä¿å–®Bï¼ˆæ³•å·´å£½éšªå‹ï¼‰</strong>ï¼šåŒ Aï¼Œé€šçŸ¥å¾Œ 5 æ—¥å…§éœ€é‚„æ¬¾<br>
                â€¢ <strong>ä¿å–®Cï¼ˆå®‰é”å¹´é‡‘å‹ï¼‰</strong>ï¼šè£œç¹³ç·š 80%ã€æ–·é ­ç·š 90%ï¼Œ<strong>é€šçŸ¥å¾Œ 2 æ—¥å…§</strong>éœ€é‚„æ¬¾<br>
                â€¢ <strong>ä¿å–®Dï¼ˆå®‰è¯å¹´é‡‘å‹ï¼‰</strong>ï¼šè£œç¹³ç·š 60%ã€æ–·é ­ç·š 70%ï¼Œ<strong>é€šçŸ¥å¾Œ 2 æ—¥å…§</strong>éœ€é‚„æ¬¾<br>
                â€¢ <strong>ETFè³ªæŠ¼</strong>ï¼šç¶­æŒç‡ 145%ï¼ˆå€Ÿæ¬¾æ¯”ç´„ 69%ï¼‰ç‚ºè­¦ç¤ºç·šã€130%ï¼ˆç´„ 77%ï¼‰ç‚ºè¿½ç¹³ç·š
            </div>

            <h3 style="color: #667eea; margin: 20px 0;">ä¿å–®è³‡ç”¢</h3>
            <div class="policy-grid">
                <!-- ä¿å–®A -->
                <div class="policy-item">
                    <h4 style="color: #333; margin-bottom: 15px;">ä¿å–®A - æ³•å·´å¹´é‡‘å‹</h4>
                    <div style="margin: 10px 0;">
                        <span style="color: #666;">æ·¨å€¼ï¼š</span>
                        <input type="number" id="asset_policy_a" value="47" step="0.1" min="0" onchange="calculateAll()"> è¬
                    </div>
                    <div style="margin: 10px 0;">
                        <span style="color: #666;">å€Ÿæ¬¾ï¼š</span>
                        <input type="number" id="loan_policy_a" value="21.5" step="0.1" min="0" onchange="calculateAll()"> è¬
                    </div>
                    
                    <!-- å€Ÿæ¬¾æ¯”é€²åº¦æ¢ -->
                    <div class="progress-bar-container">
                        <div class="progress-bar-header">
                            <span style="color: #666;">å€Ÿæ¬¾æ¯”</span>
                            <span id="ratio_policy_a" style="font-weight: bold;">45.7%</span>
                        </div>
                        <div class="progress-bar-track">
                            <div id="progress_policy_a" class="progress-bar-fill ratio-green" style="width: 45.7%;">
                                45.7%
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.8em; color: #999;">
                            <span>å®‰å…¨ 0%</span>
                            <span style="color: #f59e0b;">âš ï¸ 80%è£œç¹³</span>
                            <span style="color: #ef4444;">ğŸš¨ 90%æ–·é ­ï¼ˆ5æ—¥å…§è£œç¹³ï¼‰</span>
                        </div>
                    </div>
                    
                    <!-- è·ŒæŠ—è·é›¢ -->
                    <div id="margin_policy_a" class="margin-info safe">
                        <strong>ğŸ›¡ï¸ è·ŒæŠ—è·é›¢</strong><br>
                        è³‡ç”¢å¯ä¸‹è·Œ <strong>42.9%</strong> æ‰åˆ°è£œç¹³ç·š<br>
                        å¯ä¸‹è·Œ <strong>49.2%</strong> æ‰åˆ°æ–·é ­ç·š
                    </div>

                    <!-- è‚¡ç½æ¨¡æ“¬ -->
                    <div class="disaster-info">
                        <strong>ğŸ“‰ è‚¡ç½æ¨¡æ“¬</strong><br>
                        è·Œ 30% â†’ å€Ÿæ¬¾æ¯” <span id="disaster30_policy_a">â€”</span>ï¼…<br>
                        è·Œ 40% â†’ å€Ÿæ¬¾æ¯” <span id="disaster40_policy_a">â€”</span>ï¼…<br>
                        è·Œ <span id="disaster_custom_label_policy_a">0</span>% â†’ å€Ÿæ¬¾æ¯” <span id="disasterCustom_policy_a">â€”</span>ï¼…
                    </div>

                    <!-- è‡ªå„Ÿæ¯” & ç¾é‡‘æµè²¢ç» -->
                    <div class="disaster-info" style="margin-top:8px; background:#ecfdf5;">
                        <strong>ğŸ’§ è‡ªå„Ÿæ¯”èˆ‡ç¾é‡‘æµè²¢ç»</strong><br>
                        è‡ªå„Ÿæ¯”ï¼ˆé…æ¯ / åˆ©æ¯ï¼‰ï¼š<span id="selfrep_policy_a">â€”</span><br>
                        é ä¼°æœˆæ·¨ç¾é‡‘æµï¼ˆé…æ¯-åˆ©æ¯ï¼‰ï¼š<span id="cashflow_policy_a">â€”</span> å…ƒ
                    </div>
                    
                    <div style="margin: 10px 0; font-size: 0.9em; color: #999;">
                        å ±é…¬ç‡ï¼š-6%
                    </div>
                </div>

                <!-- ä¿å–®B -->
                <div class="policy-item">
                    <h4 style="color: #333; margin-bottom: 15px;">ä¿å–®B - æ³•å·´å£½éšªå‹</h4>
                    <div style="margin: 10px 0;">
                        <span style="color: #666;">æ·¨å€¼ï¼š</span>
                        <input type="number" id="asset_policy_b" value="146" step="0.1" min="0" onchange="calculateAll()"> è¬
                    </div>
                    <div style="margin: 10px 0;">
                        <span style="color: #666;">å€Ÿæ¬¾ï¼š</span>
                        <input type="number" id="loan_policy_b" value="68.5" step="0.1" min="0" onchange="calculateAll()"> è¬
                    </div>
                    
                    <div class="progress-bar-container">
                        <div class="progress-bar-header">
                            <span style="color: #666;">å€Ÿæ¬¾æ¯”</span>
                            <span id="ratio_policy_b" style="font-weight: bold;">46.9%</span>
                        </div>
                        <div class="progress-bar-track">
                            <div id="progress_policy_b" class="progress-bar-fill ratio-green" style="width: 46.9%;">
                                46.9%
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.8em; color: #999;">
                            <span>å®‰å…¨ 0%</span>
                            <span style="color: #f59e0b;">âš ï¸ 80%è£œç¹³</span>
                            <span style="color: #ef4444;">ğŸš¨ 90%æ–·é ­ï¼ˆ5æ—¥å…§è£œç¹³ï¼‰</span>
                        </div>
                    </div>
                    
                    <div id="margin_policy_b" class="margin-info safe">
                        <strong>ğŸ›¡ï¸ è·ŒæŠ—è·é›¢</strong><br>
                        è³‡ç”¢å¯ä¸‹è·Œ <strong>41.4%</strong> æ‰åˆ°è£œç¹³ç·š<br>
                        å¯ä¸‹è·Œ <strong>47.9%</strong> æ‰åˆ°æ–·é ­ç·š
                    </div>

                    <div class="disaster-info">
                        <strong>ğŸ“‰ è‚¡ç½æ¨¡æ“¬</strong><br>
                        è·Œ 30% â†’ å€Ÿæ¬¾æ¯” <span id="disaster30_policy_b">â€”</span>ï¼…<br>
                        è·Œ 40% â†’ å€Ÿæ¬¾æ¯” <span id="disaster40_policy_b">â€”</span>ï¼…<br>
                        è·Œ <span id="disaster_custom_label_policy_b">0</span>% â†’ å€Ÿæ¬¾æ¯” <span id="disasterCustom_policy_b">â€”</span>ï¼…
                    </div>

                    <div class="disaster-info" style="margin-top:8px; background:#ecfdf5;">
                        <strong>ğŸ’§ è‡ªå„Ÿæ¯”èˆ‡ç¾é‡‘æµè²¢ç»</strong><br>
                        è‡ªå„Ÿæ¯”ï¼ˆé…æ¯ / åˆ©æ¯ï¼‰ï¼š<span id="selfrep_policy_b">â€”</span><br>
                        é ä¼°æœˆæ·¨ç¾é‡‘æµï¼ˆé…æ¯-åˆ©æ¯ï¼‰ï¼š<span id="cashflow_policy_b">â€”</span> å…ƒ
                    </div>
                    
                    <div style="margin: 10px 0; font-size: 0.9em; color: #999;">
                        å ±é…¬ç‡ï¼š-3.3%
                    </div>
                </div>

                <!-- ä¿å–®C -->
                <div class="policy-item">
                    <h4 style="color: #333; margin-bottom: 15px;">ä¿å–®C - å®‰é”å¹´é‡‘å‹</h4>
                    <div style="margin: 10px 0;">
                        <span style="color: #666;">æ·¨å€¼ï¼š</span>
                        <input type="number" id="asset_policy_c" value="178" step="0.1" min="0" onchange="calculateAll()"> è¬
                    </div>
                    <div style="margin: 10px 0;">
                        <span style="color: #666;">å€Ÿæ¬¾ï¼š</span>
                        <input type="number" id="loan_policy_c" value="84" step="0.1" min="0" onchange="calculateAll()"> è¬
                    </div>
                    
                    <div class="progress-bar-container">
                        <div class="progress-bar-header">
                            <span style="color: #666;">å€Ÿæ¬¾æ¯”</span>
                            <span id="ratio_policy_c" style="font-weight: bold;">47.2%</span>
                        </div>
                        <div class="progress-bar-track">
                            <div id="progress_policy_c" class="progress-bar-fill ratio-green" style="width: 47.2%;">
                                47.2%
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.8em; color: #999;">
                            <span>å®‰å…¨ 0%</span>
                            <span style="color: #f59e0b;">âš ï¸ 80%è£œç¹³</span>
                            <span style="color: #ef4444;">ğŸš¨ 90%æ–·é ­ï¼ˆ2æ—¥å…§è£œç¹³ï¼‰</span>
                        </div>
                    </div>
                    
                    <div id="margin_policy_c" class="margin-info safe">
                        <strong>ğŸ›¡ï¸ è·ŒæŠ—è·é›¢</strong><br>
                        è³‡ç”¢å¯ä¸‹è·Œ <strong>41.0%</strong> æ‰åˆ°è£œç¹³ç·š<br>
                        å¯ä¸‹è·Œ <strong>47.6%</strong> æ‰åˆ°æ–·é ­ç·š
                    </div>

                    <div class="disaster-info">
                        <strong>ğŸ“‰ è‚¡ç½æ¨¡æ“¬</strong><br>
                        è·Œ 30% â†’ å€Ÿæ¬¾æ¯” <span id="disaster30_policy_c">â€”</span>ï¼…<br>
                        è·Œ 40% â†’ å€Ÿæ¬¾æ¯” <span id="disaster40_policy_c">â€”</span>ï¼…<br>
                        è·Œ <span id="disaster_custom_label_policy_c">0</span>% â†’ å€Ÿæ¬¾æ¯” <span id="disasterCustom_policy_c">â€”</span>ï¼…
                    </div>

                    <div class="disaster-info" style="margin-top:8px; background:#ecfdf5;">
                        <strong>ğŸ’§ è‡ªå„Ÿæ¯”èˆ‡ç¾é‡‘æµè²¢ç»</strong><br>
                        è‡ªå„Ÿæ¯”ï¼ˆé…æ¯ / åˆ©æ¯ï¼‰ï¼š<span id="selfrep_policy_c">â€”</span><br>
                        é ä¼°æœˆæ·¨ç¾é‡‘æµï¼ˆé…æ¯-åˆ©æ¯ï¼‰ï¼š<span id="cashflow_policy_c">â€”</span> å…ƒ
                    </div>
                    
                    <div style="margin: 10px 0; font-size: 0.9em; color: #999;">
                        å ±é…¬ç‡ï¼š+4%
                    </div>
                </div>

                <!-- ä¿å–®D -->
                <div class="policy-item" style="border-color: #10b981; border-width: 3px;">
                    <h4 style="color: #10b981; margin-bottom: 15px;">ä¿å–®D - å®‰è¯å¹´é‡‘å‹ â­</h4>
                    <div style="margin: 10px 0;">
                        <span style="color: #666;">æ·¨å€¼ï¼š</span>
                        <input type="number" id="asset_policy_d" value="324" step="0.1" min="0" onchange="calculateAll()"> è¬
                    </div>
                    <div style="margin: 10px 0;">
                        <span style="color: #666;">å€Ÿæ¬¾ï¼š</span>
                        <input type="number" id="loan_policy_d" value="90" step="0.1" min="0" onchange="calculateAll()"> è¬
                    </div>
                    
                    <div class="progress-bar-container">
                        <div class="progress-bar-header">
                            <span style="color: #666;">å€Ÿæ¬¾æ¯”</span>
                            <span id="ratio_policy_d" style="font-weight: bold;">27.8%</span>
                        </div>
                        <div class="progress-bar-track">
                            <div id="progress_policy_d" class="progress-bar-fill ratio-green" style="width: 27.8%;">
                                27.8%
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.8em; color: #999;">
                            <span>å®‰å…¨ 0%</span>
                            <span style="color: #f59e0b;">âš ï¸ 60%è£œç¹³</span>
                            <span style="color: #ef4444;">âŒ 70%æ–·é ­ï¼ˆ2æ—¥å…§è£œç¹³ï¼‰</span>
                        </div>
                    </div>
                    
                    <div id="margin_policy_d" class="margin-info safe">
                        <strong>ğŸ›¡ï¸ è·ŒæŠ—è·é›¢</strong><br>
                        è³‡ç”¢å¯ä¸‹è·Œ <strong>53.7%</strong> æ‰åˆ°è£œç¹³ç·š<br>
                        å¯ä¸‹è·Œ <strong>60.3%</strong> æ‰åˆ°æ–·é ­ç·š
                    </div>

                    <div class="disaster-info">
                        <strong>ğŸ“‰ è‚¡ç½æ¨¡æ“¬</strong><br>
                        è·Œ 30% â†’ å€Ÿæ¬¾æ¯” <span id="disaster30_policy_d">â€”</span>ï¼…<br>
                        è·Œ 40% â†’ å€Ÿæ¬¾æ¯” <span id="disaster40_policy_d">â€”</span>ï¼…<br>
                        è·Œ <span id="disaster_custom_label_policy_d">0</span>% â†’ å€Ÿæ¬¾æ¯” <span id="disasterCustom_policy_d">â€”</span>ï¼…
                    </div>

                    <div class="disaster-info" style="margin-top:8px; background:#ecfdf5;">
                        <strong>ğŸ’§ è‡ªå„Ÿæ¯”èˆ‡ç¾é‡‘æµè²¢ç»</strong><br>
                        è‡ªå„Ÿæ¯”ï¼ˆé…æ¯ / åˆ©æ¯ï¼‰ï¼š<span id="selfrep_policy_d">â€”</span><br>
                        é ä¼°æœˆæ·¨ç¾é‡‘æµï¼ˆé…æ¯-åˆ©æ¯ï¼‰ï¼š<span id="cashflow_policy_d">â€”</span> å…ƒ
                    </div>
                    
                    <div style="margin: 10px 0; font-size: 0.9em; color: #999;">
                        å ±é…¬ç‡ï¼š+8% | â­ å„ªå…ˆåŠ ç¢¼
                    </div>
                </div>
            </div>

            <!-- è·Œå¹…æ»‘æ¡¿æ¨¡æ“¬ -->
            <div class="alert alert-info" style="margin-top:25px;">
                <strong>ğŸ“‰ è®Šå‹•è·Œå¹…æ¨¡æ“¬ï¼ˆè‡ªè¨‚è‚¡ç½æƒ…å¢ƒï¼‰</strong><br>
                æ‹–æ›³æ»‘æ¡¿å³å¯æ¨¡æ“¬ã€Œæ‰€æœ‰ä¿å–® + ETFã€åœ¨æŸå€‹è·Œå¹…ä¸‹çš„æ–°å€Ÿæ¬¾æ¯”ï¼š<br>
                <div style="margin-top:10px; display:flex; align-items:center; gap:10px;">
                    <input type="range" id="disaster_slider" min="0" max="60" value="30" step="1" oninput="calculateAll()" style="flex:1;">
                    <span>ç›®å‰è‡ªè¨‚è·Œå¹…ï¼š<strong><span id="disaster_slider_value">30</span>%</strong></span>
                </div>
                <small style="color:#374151;">ä¾‹å¦‚ï¼šè¨­å®š 45% å°±å¤§ç´„æ˜¯ä»‹æ–¼ 2008 é‡‘èæµ·å˜¯ï¼ˆè‚¡å¸‚è…°æ–¬ï¼‰è·Ÿæ›´æ…˜ä¸€é»çš„æƒ…å¢ƒã€‚</small>
            </div>

            <h3 style="color: #667eea; margin: 30px 0 20px 0;">å…¶ä»–è³‡ç”¢</h3>
            <div class="policy-grid">
                <!-- ETF -->
                <div class="policy-item">
                    <h4 style="color: #333; margin-bottom: 15px;">å°è‚¡é«˜è‚¡æ¯ETFï¼ˆè³ªæŠ¼ï¼‰</h4>
                    <div style="margin: 10px 0;">
                        <span style="color: #666;">æ·¨å€¼ï¼š</span>
                        <input type="number" id="asset_etf" value="173" step="0.1" min="0" onchange="calculateAll()"> è¬
                    </div>
                    <div style="margin: 10px 0;">
                        <span style="color: #666;">è³ªæŠ¼å€Ÿæ¬¾ï¼š</span>
                        <input type="number" id="loan_etf" value="40" step="0.1" min="0" onchange="calculateAll()"> è¬
                    </div>
                    
                    <div class="progress-bar-container">
                        <div class="progress-bar-header">
                            <span style="color: #666;">å€Ÿæ¬¾æ¯”</span>
                            <span id="ratio_etf" style="font-weight: bold;">23.1%</span>
                        </div>
                        <div class="progress-bar-track">
                            <div id="progress_etf" class="progress-bar-fill ratio-green" style="width: 23.1%;">
                                23.1%
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.8em; color: #999;">
                            <span>å®‰å…¨ 0%</span>
                            <span style="color: #f59e0b;">ğŸ’› 69%ï¼ˆ145%ç¶­æŒç‡ï¼‰</span>
                            <span style="color: #ef4444;">ğŸš¨ 77%ï¼ˆ130%ç¶­æŒç‡ï¼‰</span>
                        </div>
                    </div>
                    
                    <div id="margin_etf" class="margin-info safe">
                        <strong>ğŸ›¡ï¸ è·ŒæŠ—è·é›¢</strong><br>
                        è³‡ç”¢å¯ä¸‹è·Œ <strong>70.0%</strong> æ‰åˆ°è£œç¹³ç·š<br>
                        ç•¶å‰ç¶­æŒç‡ï¼š<strong>433%</strong>ï¼ˆé é«˜æ–¼130%å®‰å…¨ç·šï¼‰
                    </div>

                    <div class="disaster-info">
                        <strong>ğŸ“‰ è‚¡ç½æ¨¡æ“¬</strong><br>
                        è·Œ 30% â†’ å€Ÿæ¬¾æ¯” <span id="disaster30_etf">â€”</span>ï¼…<br>
                        è·Œ 40% â†’ å€Ÿæ¬¾æ¯” <span id="disaster40_etf">â€”</span>ï¼…<br>
                        è·Œ <span id="disaster_custom_label_etf">0</span>% â†’ å€Ÿæ¬¾æ¯” <span id="disasterCustom_etf">â€”</span>ï¼…
                    </div>

                    <div class="disaster-info" style="margin-top:10px; background:#ecfeff;">
                        <strong>ğŸ§® è‚¡ç¥¨è³ªæŠ¼ â€” æœ€ä½è£œç¹³é‡‘é¡è©¦ç®—</strong><br>
                        ç›®æ¨™å€Ÿæ¬¾æ¯”ï¼š
                        <input type="number" id="target_ratio_etf" value="60" step="1" min="0" max="100" style="width:80px;" onchange="calculateAll()"> %
                        <br>
                        ç‚ºé”åˆ°ç›®æ¨™å€Ÿæ¬¾æ¯”ï¼Œéœ€è¦<strong>æœ€ä½è£œç¹³</strong>ï¼š
                        <strong><span id="etf_min_repay">0.0</span> è¬</strong>
                        <br>
                        <small style="color:#555;">ï¼ˆè©¦ç®—ï¼šè‹¥ç•¶å‰å€Ÿæ¬¾æ¯”é«˜æ–¼ç›®æ¨™ï¼Œå°±è¨ˆç®—éœ€é‚„å¤šå°‘è¬ï¼Œè®“å€Ÿæ¬¾æ¯”é™å›ç›®æ¨™ï¼‰</small>
                    </div>
                    
                    <div style="margin: 10px 0; font-size: 0.9em; color: #999;">
                        åŒ¯ç‡å°æ²– + æµå‹•æ€§å‚™ç”¨
                    </div>
                </div>

                <!-- ç¾é‡‘ -->
                <div class="policy-item">
                    <h4 style="color: #333; margin-bottom: 15px;">ç¾é‡‘</h4>
                    <div style="margin: 10px 0;">
                        <span style="color: #666;">å¸³é¢ç¾é‡‘ï¼š</span>
                        <input type="number" id="asset_cash" value="45" step="0.1" min="0" onchange="calculateAll()"> è¬
                    </div>
                    <div style="margin: 10px 0; font-size: 0.9em; color: #999;">
                        + ETFå¯å€Ÿ 50è¬<br>
                        + å¾ªç’°ä¿¡è²¸å¯å€Ÿ 36è¬<br>
                        = ç¸½å¯å‹•ç”¨ <span style="font-weight: bold; color: #10b981;"><span id="total_available_cash">131</span>è¬</span>
                    </div>
                </div>

                <!-- æˆ¿è²¸èˆ‡ä¿¡è²¸ -->
                <div class="policy-item">
                    <h4 style="color: #333; margin-bottom: 15px;">æˆ¿è²¸èˆ‡ä¿¡è²¸</h4>
                    <div style="margin: 10px 0;">
                        <span style="color: #666;">æˆ¿è²¸é¤˜é¡ï¼š</span>
                        <input type="number" id="loan_mortgage" value="462" step="0.1" min="0" onchange="calculateAll()"> è¬
                        <div style="font-size: 0.9em; color: #999; margin-top: 5px;">åˆ©ç‡ 2.7%</div>
                    </div>
                    <div style="margin: 10px 0;">
                        <span style="color: #666;">ä¿¡è²¸é¤˜é¡ï¼š</span>
                        <input type="number" id="loan_credit" value="98" step="0.1" min="0" onchange="calculateAll()"> è¬
                        <div style="font-size: 0.9em; color: #999; margin-top: 5px;">æœˆé‚„æ¬¾ 13,000å…ƒï¼ˆå«æœ¬æ¯ï¼‰</div>
                    </div>
                </div>
            </div>

            <!-- ç¸½è¨ˆ -->
            <div class="total-box">
                <h3 style="color: white; margin-bottom: 20px;">ğŸ’° è³‡ç”¢è² å‚µç¸½è¦½</h3>
                <div class="total-grid">
                    <div>
                        <div style="font-size: 0.9em; opacity: 0.9;">ç¸½è³‡ç”¢</div>
                        <div style="font-size: 2.2em; font-weight: bold;"><span id="total_assets">913</span>è¬</div>
                    </div>
                    <div>
                        <div style="font-size: 0.9em; opacity: 0.9;">ç¸½è² å‚µ</div>
                        <div style="font-size: 2.2em; font-weight: bold;"><span id="total_liabilities">764</span>è¬</div>
                    </div>
                    <div>
                        <div style="font-size: 0.9em; opacity: 0.9;">æ·¨è³‡ç”¢</div>
                        <div style="font-size: 2.2em; font-weight: bold;"><span id="net_assets">149</span>è¬</div>
                    </div>
                    <div>
                        <div style="font-size: 0.9em; opacity: 0.9;">æ•´é«”æ§“æ¡¿ç‡</div>
                        <div style="font-size: 2.2em; font-weight: bold;"><span id="leverage_ratio">83.7</span>%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ”¶æ”¯æ˜ç´° -->
        <div class="section">
            <h2 class="section-title">ğŸ’³ æ¯æœˆæ”¶æ”¯æ˜ç´°ï¼ˆå¯ç·¨è¼¯ï¼‰</h2>
            
            <h3 style="color: #10b981; margin: 20px 0;">ğŸ’° æ”¶å…¥</h3>
            <div class="expense-grid">
                <div class="expense-item" style="border-left-color: #10b981;">
                    <div style="color: #666; margin-bottom: 5px;">ä¸»å‹•æ”¶å…¥ï¼ˆå·¥ä½œï¼‰</div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="income_active" value="42000" step="1000" min="0" onchange="calculateAll()">
                        <span>å…ƒ/æœˆ</span>
                    </div>
                </div>
                <div class="expense-item" style="border-left-color: #10b981;">
                    <div style="color: #666; margin-bottom: 5px;">è¢«å‹•æ”¶å…¥ï¼ˆä¿å–®é…æ¯ï¼‰</div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="income_passive" value="55000" step="1000" min="0" onchange="calculateAll()">
                        <span>å…ƒ/æœˆ</span>
                    </div>
                </div>
                <div class="expense-item" style="border-left-color: #667eea; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <div style="opacity: 0.9; margin-bottom: 5px;">ç¸½æ”¶å…¥</div>
                    <div style="font-size: 1.8em; font-weight: bold;">
                        <span id="total_income">97,000</span> å…ƒ
                    </div>
                </div>
            </div>

            <h3 style="color: #3b82f6; margin: 30px 0 20px 0;">ğŸ  å›ºå®šæ”¯å‡º</h3>
            <div class="expense-grid">
                <div class="expense-item">
                    <div style="color: #666; margin-bottom: 5px;">æˆ¿è²¸</div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="expense_mortgage" value="31000" step="1000" min="0" onchange="calculateAll()">
                        <span>å…ƒ/æœˆ</span>
                    </div>
                </div>
                <div class="expense-item">
                    <div style="color: #666; margin-bottom: 5px;">ä¿¡è²¸</div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="expense_credit" value="13000" step="1000" min="0" onchange="calculateAll()">
                        <span>å…ƒ/æœˆ</span>
                    </div>
                </div>
                <div class="expense-item">
                    <div style="color: #666; margin-bottom: 5px;">ç”Ÿæ´»å¿…éœ€</div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="expense_living" value="15000" step="1000" min="0" onchange="calculateAll()">
                        <span>å…ƒ/æœˆ</span>
                    </div>
                </div>
                <div class="expense-item">
                    <div style="color: #666; margin-bottom: 5px;">ä¿éšª</div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="expense_insurance" value="6000" step="1000" min="0" onchange="calculateAll()">
                        <span>å…ƒ/æœˆ</span>
                    </div>
                </div>
                <div class="expense-item">
                    <div style="color: #666; margin-bottom: 5px;">é€šè¨Šç¶²è·¯</div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="expense_communication" value="2000" step="500" min="0" onchange="calculateAll()">
                        <span>å…ƒ/æœˆ</span>
                    </div>
                </div>
                <div class="expense-item">
                    <div style="color: #666; margin-bottom: 5px;">é†«ç™‚ä¿å¥</div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="expense_health" value="4000" step="1000" min="0" onchange="calculateAll()">
                        <span>å…ƒ/æœˆ</span>
                    </div>
                </div>
                <div class="expense-item" style="border-left-color: #3b82f6; background: #eff6ff;">
                    <div style="color: #1e40af; margin-bottom: 5px; font-weight: bold;">å›ºå®šæ”¯å‡ºå°è¨ˆ</div>
                    <div style="font-size: 1.5em; font-weight: bold; color: #3b82f6;">
                        <span id="total_fixed_expense">57,000</span> å…ƒ
                    </div>
                </div>
            </div>

            <h3 style="color: #f59e0b; margin: 30px 0 20px 0;">ğŸ‰ å½ˆæ€§æ”¯å‡ºï¼ˆå¯å£“ç¸®ï¼‰</h3>
            <div class="expense-grid">
                <div class="expense-item" style="border-left-color: #f59e0b;">
                    <div style="color: #666; margin-bottom: 5px;">å¨›æ¨‚ä¼‘é–’</div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="expense_entertainment" value="0" step="1000" min="0" onchange="calculateAll()">
                        <span>å…ƒ/æœˆ</span>
                    </div>
                </div>
                <div class="expense-item" style="border-left-color: #f59e0b;">
                    <div style="color: #666; margin-bottom: 5px;">æœé£¾è³¼ç‰©</div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="expense_shopping" value="0" step="1000" min="0" onchange="calculateAll()">
                        <span>å…ƒ/æœˆ</span>
                    </div>
                </div>
                <div class="expense-item" style="border-left-color: #f59e0b;">
                    <div style="color: #666; margin-bottom: 5px;">é€²ä¿®å­¸ç¿’</div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="expense_learning" value="0" step="1000" min="0" onchange="calculateAll()">
                        <span>å…ƒ/æœˆ</span>
                    </div>
                </div>
                <div class="expense-item" style="border-left-color: #f59e0b;">
                    <div style="color: #666; margin-bottom: 5px;">å…¶ä»–é›œæ”¯</div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="expense_other" value="0" step="1000" min="0" onchange="calculateAll()">
                        <span>å…ƒ/æœˆ</span>
                    </div>
                </div>
                <div class="expense-item" style="border-left-color: #f59e0b; background: #fef3c7;">
                    <div style="color: #92400e; margin-bottom: 5px; font-weight: bold;">å½ˆæ€§æ”¯å‡ºå°è¨ˆ</div>
                    <div style="font-size: 1.5em; font-weight: bold; color: #f59e0b;">
                        <span id="total_flexible_expense">0</span> å…ƒ
                    </div>
                </div>
            </div>

            <h3 style="color: #ef4444; margin: 30px 0 20px 0;">ğŸ’¸ åˆ©æ¯æ”¯å‡ºï¼ˆå¯ç·¨è¼¯ï¼‰</h3>
            <div class="alert alert-info">
                <strong>âœ¨ ä¿å–®èˆ‡ETFåˆ©æ¯å¯æ‰‹å‹•å¾®èª¿ï¼š</strong>å¯ä»¥å…ˆç”¨è‡ªå‹•è¨ˆç®—å€¼ï¼Œå†ä¾å¯¦éš›å¸³å–®èª¿æ•´ã€‚
            </div>
            <div class="expense-grid">
                <div class="expense-item" style="border-left-color: #ef4444;">
                    <div style="color: #666; margin-bottom: 5px;">ä¿å–®å€Ÿæ¬¾åˆ©æ¯</div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="interest_policy_input" value="8800" step="100" min="0" onchange="calculateAll()">
                        <span>å…ƒ/æœˆ</span>
                    </div>
                    <div style="font-size: 0.85em; color: #999; margin-top: 5px;">
                        å€Ÿæ¬¾ <span id="display_policy_loan">264</span>è¬ @ 4%<br>
                        è‡ªå‹•è¨ˆç®—å€¼ï¼š<span id="interest_policy_auto">8,800</span>å…ƒ
                    </div>
                </div>
                <div class="expense-item" style="border-left-color: #ef4444;">
                    <div style="color: #666; margin-bottom: 5px;">ETFè³ªæŠ¼åˆ©æ¯</div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" id="interest_etf_input" value="100" step="10" min="0" onchange="calculateAll()">
                        <span>å…ƒ/æœˆ</span>
                    </div>
                    <div style="font-size: 0.85em; color: #999; margin-top: 5px;">
                        å€Ÿæ¬¾ <span id="display_etf_loan">40</span>è¬ @ 3%<br>
                        è‡ªå‹•è¨ˆç®—å€¼ï¼š<span id="interest_etf_auto">100</span>å…ƒ
                    </div>
                </div>
                <div class="expense-item" style="border-left-color: #ef4444; background: #fee2e2;">
                    <div style="color: #991b1b; margin-bottom: 5px; font-weight: bold;">æŠ•è³‡ç›¸é—œåˆ©æ¯å°è¨ˆ</div>
                    <div style="font-size: 1.5em; font-weight: bold; color: #ef4444;">
                        <span id="total_interest">8,900</span> å…ƒ/æœˆ
                    </div>
                    <div style="font-size: 0.85em; color: #999; margin-top: 5px;">
                        ä¿å–® + ETF åˆ©æ¯ï¼ˆå¯æ‰‹å‹•èª¿æ•´ï¼‰<br>
                        (æˆ¿è²¸ã€ä¿¡è²¸å·²å«åœ¨å›ºå®šæ”¯å‡ºä¸­)
                    </div>
                </div>
            </div>

            <!-- æ”¶æ”¯ç¸½è¦½ -->
            <div class="total-box" style="margin-top: 30px;">
                <h3 style="color: white; margin-bottom: 20px;">ğŸ“Š æ”¶æ”¯ç¸½è¦½</h3>
                <div class="total-grid">
                    <div>
                        <div style="font-size: 0.9em; opacity: 0.9;">ç¸½æ”¶å…¥</div>
                        <div style="font-size: 2em; font-weight: bold;"><span id="display_total_income">97,000</span></div>
                        <div style="font-size: 0.85em; opacity: 0.8; margin-top: 5px;">å…ƒ/æœˆ</div>
                    </div>
                    <div>
                        <div style="font-size: 0.9em; opacity: 0.9;">ç¸½æ”¯å‡º</div>
                        <div style="font-size: 2em; font-weight: bold;"><span id="display_total_expense">78,252</span></div>
                        <div style="font-size: 0.85em; opacity: 0.8; margin-top: 5px;">å…ƒ/æœˆ</div>
                    </div>
                    <div>
                        <div style="font-size: 0.9em; opacity: 0.9;">æœˆç›ˆé¤˜</div>
                        <div style="font-size: 2em; font-weight: bold;"><span id="monthly_surplus">18,748</span></div>
                        <div style="font-size: 0.85em; opacity: 0.8; margin-top: 5px;">å¯æŠ•è³‡é‡‘é¡</div>
                    </div>
                    <div>
                        <div style="font-size: 0.9em; opacity: 0.9;">å„²è“„ç‡</div>
                        <div style="font-size: 2em; font-weight: bold;"><span id="saving_rate">19.3</span>%</div>
                        <div style="font-size: 0.85em; opacity: 0.8; margin-top: 5px;">ç›ˆé¤˜Ã·æ”¶å…¥</div>
                    </div>
                    <div>
                        <div style="font-size: 0.9em; opacity: 0.9;">å¹´å¯æŠ•è³‡</div>
                        <div style="font-size: 2em; font-weight: bold;"><span id="annual_investment">224,976</span></div>
                        <div style="font-size: 0.85em; opacity: 0.8; margin-top: 5px;">å…ƒ/å¹´</div>
                    </div>
                </div>
            </div>

            <div class="alert alert-warning">
                <strong>ğŸ’¡ å„ªåŒ–å»ºè­°</strong><br>
                â€¢ ç›®æ¨™æœˆç›ˆé¤˜ï¼š2.5è¬ä»¥ä¸Šï¼ˆåŠ é€Ÿé”æ¨™ï¼‰<br>
                â€¢ å½ˆæ€§æ”¯å‡ºå·²é è¨­ç‚º 0ï¼Œå¦‚è¦æ”¾é¬†å¯å°‘é‡å¢åŠ ä½†æ³¨æ„å„²è“„ç‡<br>
                â€¢ æˆ–å¢åŠ ä¸»å‹•æ”¶å…¥ï¼šç›®æ¨™5-6è¬/æœˆ<br>
                â€¢ å„²è“„ç‡æå‡åˆ°25-30%æœ€ç†æƒ³
            </div>
        </div>

        <!-- é”æ¨™è©•ä¼° -->
        <div class="section">
            <h2 class="section-title">ğŸ¯ 45æ­²é”æ¨™è©•ä¼°ï¼ˆ7å¹´å„²è“„â†’8%é…æ¯ï¼‰</h2>
            
            <div class="alert alert-info">
                <strong>ğŸ“ ç•¶å‰ç‹€æ…‹</strong><br>
                å¹´é½¡ï¼š38æ­² | è·é›¢45æ­²ï¼š<strong>7å¹´</strong><br>
                ç›®å‰æœˆé…æ¯ï¼š<strong><span id="display_passive_income">5.5</span>è¬</strong>ï¼ˆä¾†è‡ªç¾æœ‰è³‡ç”¢ï¼‰<br>
                ç›®æ¨™ï¼š<strong>7è¬/æœˆ</strong>
            </div>

            <!-- é€²åº¦æ¢ï¼ˆç›®å‰é…æ¯ vs ç›®æ¨™ï¼‰ -->
            <div style="margin: 30px 0;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span style="font-weight: bold; color: #667eea;">ç›®å‰é…æ¯é”æˆé€²åº¦</span>
                    <span style="font-weight: bold; color: #667eea;"><span id="progress_percentage">79</span>%</span>
                </div>
                <div style="width: 100%; height: 40px; background: #e5e7eb; border-radius: 20px; overflow: hidden; position: relative;">
                    <div id="progress_bar" style="height: 100%; background: linear-gradient(90deg, #10b981, #059669); width: 79%; transition: width 1s ease-out; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.1em;">
                        <span id="progress_text">5.5è¬ / 7è¬</span>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 0.9em; color: #666;">
                    <span>èµ·é» 0è¬</span>
                    <span style="color: #10b981; font-weight: bold;">ç›®æ¨™ 7è¬</span>
                </div>
            </div>

            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-label">å¹´æŠ•è³‡é¡ï¼ˆä¾ç›®å‰æœˆç›ˆé¤˜ï¼‰</div>
                    <div class="summary-value" style="color: #667eea;"><span id="display_annual_inv">22.5</span> è¬/å¹´</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">7å¹´ç´¯ç©æŠ•å…¥æœ¬é‡‘</div>
                    <div class="summary-value" style="color: #667eea;"><span id="seven_year_inv">157.5</span> è¬</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">7å¹´å„²è“„æœ¬åˆ©å’Œï¼ˆå¹´åŒ– 5%ï¼‰</div>
                    <div class="summary-value" style="color: #10b981;"><span id="estimated_networth_45">0</span> è¬</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">è½‰æŠ•å…¥ 8% é…æ¯å¾Œã€Œæ–°å¢æœˆé…æ¯ã€</div>
                    <div class="summary-value" style="color: #10b981;"><span id="estimated_income_45">0.0</span> è¬/æœˆ</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">45æ­²é ä¼°ç¸½æœˆé…æ¯ï¼ˆå«ç¾åœ¨ï¼‰</div>
                    <div class="summary-value" style="color: #16a34a;"><span id="estimated_total_passive_45">0.0</span> è¬/æœˆ</div>
                </div>
            </div>

            <div class="alert alert-success">
                <strong>âœ… é”æ¨™é æ¸¬ï¼ˆä¾ç›®å‰æ•¸å­—å‹•æ…‹è©¦ç®—ï¼‰</strong><br>
                <span id="target_prediction">
                    ç³»çµ±æœƒä¾ã€Œç›®å‰æœˆç›ˆé¤˜ã€èˆ‡ã€Œ7å¹´å¾Œ 8% é…æ¯ã€å‹•æ…‹è©•ä¼°é”æ¨™æ©Ÿç‡ã€‚
                </span>
            </div>

            <!-- ç›®æ¨™æœˆé…æ¯ â†’ åæ¨éœ€è¦è³‡ç”¢ & å¹´åŒ–å ±é…¬ -->
            <div style="margin-top:30px; padding:20px; border-radius:12px; background:#fefce8; border:1px solid #facc15;">
                <h3 style="color:#ca8a04; margin-bottom:10px;">ğŸ¯ ç›®æ¨™æœˆé…æ¯ â†’ åæ¨éœ€è¦è³‡ç”¢ & å ±é…¬ç‡</h3>
                <div class="expense-grid">
                    <div class="expense-item" style="border-left-color:#eab308;">
                        <div style="color:#854d0e; margin-bottom:5px;">ç›®æ¨™æœˆé…æ¯</div>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <input type="number" id="target_monthly_income" value="70000" step="5000" min="0" onchange="calculateAll()">
                            <span>å…ƒ / æœˆ</span>
                        </div>
                    </div>
                    <div class="expense-item" style="border-left-color:#eab308;">
                        <div style="color:#854d0e; margin-bottom:5px;">é æœŸé…æ¯ç‡ï¼ˆå¹´åŒ–ï¼‰</div>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <input type="number" id="target_yield" value="8" step="0.5" min="1" max="15" onchange="calculateAll()">
                            <span>% / å¹´</span>
                        </div>
                    </div>
                    <div class="expense-item" style="border-left-color:#facc15; background:#fef9c3;">
                        <div class="summary-label">é”æ¨™æ‰€éœ€ã€Œé…æ¯è³‡æœ¬ã€</div>
                        <div class="summary-value" style="color:#ca8a04;"><span id="required_capital">0.0</span> è¬</div>
                    </div>
                    <div class="expense-item" style="border-left-color:#f97316; background:#fff7ed;">
                        <div class="summary-label">ç¾æœ‰é…æ¯è³‡æœ¬ï¼ˆä¿å–®+ETFï¼‰</div>
                        <div class="summary-value" style="color:#ea580c;"><span id="current_capital">0.0</span> è¬</div>
                    </div>
                    <div class="expense-item" style="border-left-color:#f97316; background:#fff7ed;">
                        <div class="summary-label">è³‡æœ¬ç¼ºå£</div>
                        <div class="summary-value" style="color:#b91c1c;"><span id="capital_gap">0.0</span> è¬</div>
                    </div>
                </div>
                <div class="alert alert-info" style="margin-top:15px;">
                    <span id="capital_comment">
                        ç³»çµ±æœƒæ ¹æ“šã€Œç›®æ¨™æœˆé…æ¯ã€èˆ‡ã€Œå‡è¨­é…æ¯ç‡ã€ä¼°ç®—ä½ éœ€è¦ç´¯ç©å¤šå°‘å¯é…æ¯è³‡ç”¢ï¼Œä¸¦èˆ‡ç›®å‰ä¿å–®+ETF è¦æ¨¡æ¯”è¼ƒã€‚
                    </span>
                </div>
            </div>

            <!-- æ§“æ¡¿å®‰å…¨é›·é” / ç¸½é«”è©•åˆ† -->
            <div style="margin-top:30px; padding:20px; border-radius:12px; background:#f9fafb; border:1px solid #e5e7eb;">
                <h3 style="color:#0f766e; margin-bottom:10px;">ğŸ›¡ï¸ æ§“æ¡¿å®‰å…¨é›·é” / ç¸½é«”è©•åˆ†</h3>
                <div class="summary-grid">
                    <div class="summary-item" style="border-left-color:#0f766e;">
                        <div class="summary-label">ç¸½é«”å®‰å…¨åˆ†æ•¸ï¼ˆ0â€“100ï¼‰</div>
                        <div class="summary-value" style="color:#0f766e;"><span id="safety_score">0</span> åˆ†</div>
                        <div style="margin-top:5px;">
                            <span id="safety_level" class="safety-badge" style="background:#dcfce7; color:#166534;">â€”</span>
                        </div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">æ•´é«”æ§“æ¡¿ç‡</div>
                        <div class="summary-value"><span id="safety_leverage">0.0</span>%</div>
                        <div style="font-size:0.85em; color:#6b7280; margin-top:5px;">ï¼ˆç¸½è² å‚µ Ã· ç¸½è³‡ç”¢ï¼‰</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">ä¿å–®å¹³å‡å€Ÿæ¬¾æ¯”</div>
                        <div class="summary-value"><span id="safety_policy_ratio">0.0</span>%</div>
                        <div style="font-size:0.85em; color:#6b7280; margin-top:5px;">ï¼ˆA+B+C+D å¹³å‡ï¼‰</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">ç¾é‡‘å¯æ”¯æ’ã€Œç¸½æ”¯å‡ºã€æœˆæ•¸</div>
                        <div class="summary-value"><span id="safety_cash_months">0.0</span> æœˆ</div>
                        <div style="font-size:0.85em; color:#6b7280; margin-top:5px;">ï¼ˆå¸³é¢ç¾é‡‘ Ã· ç•¶å‰æœˆæ”¯å‡ºï¼‰</div>
                    </div>
                </div>
                <div style="margin-top:10px; font-size:0.95em; color:#374151;">
                    <span id="safety_comment">
                        ç³»çµ±æœƒä¾æ“šã€Œæ•´é«”æ§“æ¡¿ç‡ã€ã€ã€Œä¿å–®å¹³å‡å€Ÿæ¬¾æ¯”ã€ã€ã€Œç¾é‡‘ç·©è¡æœˆæ•¸ã€çµ¦å‡ºä¸€å€‹ç¶œåˆå®‰å…¨åˆ†æ•¸ï¼Œç•¶ä½œä½ çš„ã€Œé¢¨éšªé›·é”ã€ã€‚
                    </span>
                </div>
            </div>

            <div class="alert alert-warning" style="margin-top:25px;">
                <strong>ğŸš€ é‡é»è§€å¿µ</strong><br>
                â€¢ å„²è“„æœŸï¼šä»¥<strong>5%å¹´åŒ–</strong>ä¿å®ˆä¼°è¨ˆï¼Œå…ˆç´¯ç©ã€Œè³‡æœ¬æ¡¶ã€<br>
                â€¢ 7å¹´å¾Œï¼šä¸€æ¬¡è½‰å…¥<strong>8%é…æ¯å‹åŸºé‡‘</strong>ï¼Œæ‰“é€ ã€Œç¾é‡‘æµæ¡¶ã€<br>
                â€¢ ç›®å‰è¢«å‹•æ”¶å…¥ 5.5è¬/æœˆ å·²ç¶“æ˜¯ä½ çš„ã€Œåº•ã€ï¼Œæ–°å„²è“„åªæ˜¯å†å¾€ä¸ŠåŠ <br>
                â€¢ é—œéµæ˜¯ï¼š<strong>æœˆç›ˆé¤˜è¶Šé«˜ â†’ 7å¹´å¾Œæ–°å¢é…æ¯è¶Šå¤š â†’ é›¢ 7è¬/æœˆè¶Šè¿‘</strong>
            </div>
        </div>

        <!-- æ“ä½œèªªæ˜ & ç­–ç•¥å‚™å¿˜éŒ„ -->
        <div class="section">
            <h2 class="section-title">ğŸ“– ä½¿ç”¨èªªæ˜ & ç­–ç•¥å‚™å¿˜éŒ„</h2>
            
            <div style="line-height: 2;">
                <h4 style="color: #667eea; margin: 15px 0;">âœ¨ æœ¬ç‰ˆé‡é»å¼·åŒ–</h4>
                <ol style="margin-left: 20px;">
                    <li><strong>7å¹´å„²è“„ â†’ 8%é…æ¯è‡ªå‹•è©¦ç®—</strong>ï¼šè¼¸å…¥æ”¶å…¥/æ”¯å‡ºå¾Œï¼Œç³»çµ±æœƒç”¨æœˆç›ˆé¤˜è‡ªå‹•ç®—å‡º 7 å¹´å¾Œæ–°å¢çš„æœˆé…æ¯ã€‚</li>
                    <li><strong>å€Ÿæ¬¾æ¯”é¡è‰²åˆ†ç´š</strong>ï¼š0â€“40%ç¶ ã€40â€“60%é»ƒç¶ ã€60â€“80%é»ƒã€80â€“90%æ©˜ã€90%ä»¥ä¸Šç´…ã€‚</li>
                    <li><strong>è‚¡ç½ -30% / -40% + è‡ªè¨‚è·Œå¹…æ»‘æ¡¿</strong>ï¼šå¯æ¨¡æ“¬ 0ï½60% ä»»æ„è·Œå¹…å¾Œçš„å€Ÿæ¬¾æ¯”ã€‚</li>
                    <li><strong>æ¯å¼µä¿å–®è‡ªå„Ÿæ¯” & ç¾é‡‘æµè²¢ç»</strong>ï¼šçœ‹ã€Œé…æ¯æ˜¯å¦è¶³ä»¥è“‹éåˆ©æ¯ã€ã€‚</li>
                    <li><strong>è‚¡ç¥¨è³ªæŠ¼æœ€ä½è£œç¹³è©¦ç®—</strong>ï¼šè¼¸å…¥ç›®æ¨™å€Ÿæ¬¾æ¯”ï¼Œç®—å‡ºè‡³å°‘è¦é‚„å¤šå°‘è¬ã€‚</li>
                    <li><strong>ç›®æ¨™æœˆé…æ¯ â†’ åæ¨éœ€è¦è³‡ç”¢ & å ±é…¬ç‡</strong>ï¼šæ‹†è§£ 7 è¬/æœˆèƒŒå¾ŒçœŸæ­£éœ€è¦çš„ã€Œè³‡æœ¬è¦æ¨¡ã€ã€‚</li>
                    <li><strong>æ§“æ¡¿å®‰å…¨é›·é” / ç¸½é«”è©•åˆ†</strong>ï¼šæŠŠå¤šå€‹é¢¨éšªæŒ‡æ¨™è®Šæˆä¸€å€‹ 0â€“100 åˆ†çš„ã€Œå®‰å…¨æŒ‡æ•¸ã€ã€‚</li>
                    <li><strong>ç­–ç•¥å‚™å¿˜éŒ„</strong>ï¼šå¯«ä¸‹ä½ çš„è¦å‰‡èˆ‡ä¸‹ä¸€æ­¥è¡Œå‹•ï¼Œå’Œæ•¸æ“šä¸€èµ·å„²å­˜ã€‚</li>
                </ol>

                <h4 style="color: #667eea; margin: 15px 0;">ğŸ”§ å¦‚ä½•ä¿®æ”¹æ•¸æ“š</h4>
                <ol style="margin-left: 20px;">
                    <li>ç›´æ¥é»æ“Šä»»ä½•æ•¸å­—æ¡†é€²è¡Œç·¨è¼¯ã€‚</li>
                    <li>ä¿®æ”¹å¾ŒæŒ‰ Enter æˆ–é»æ“Šåˆ¥è™•ã€‚</li>
                    <li>ç³»çµ±æœƒè‡ªå‹•é‡æ–°è¨ˆç®—æ‰€æœ‰ç›¸é—œæ•¸æ“šã€‚</li>
                    <li>æˆ–é»æ“Šã€ŒğŸ”„ é‡æ–°è¨ˆç®—å…¨éƒ¨ã€æ‰‹å‹•åˆ·æ–°ã€‚</li>
                </ol>

                <h4 style="color: #667eea; margin: 15px 0;">ğŸ’¾ å„²å­˜èˆ‡è¼‰å…¥</h4>
                <ol style="margin-left: 20px;">
                    <li>é»ã€ŒğŸ’¾ å„²å­˜æ•¸æ“šã€â†’ å„²å­˜åœ¨ç€è¦½å™¨æœ¬æ©Ÿï¼ˆlocalStorageï¼‰ã€‚</li>
                    <li>ä¸‹æ¬¡é–‹å•ŸåŒä¸€å°è£ç½®åŒä¸€ç€è¦½å™¨æœƒè‡ªå‹•è¼‰å…¥ã€‚</li>
                    <li>ä¹Ÿå¯é»ã€ŒğŸ“‚ è¼‰å…¥æ•¸æ“šã€æ‰‹å‹•è¼‰å…¥ã€‚</li>
                </ol>

                <h4 style="color: #667eea; margin: 15px 0;">ğŸ§¹ å½ˆæ€§æ”¯å‡ºæ­¸é›¶</h4>
                <ol style="margin-left: 20px;">
                    <li>é»ã€ŒğŸ§¹ å½ˆæ€§æ”¯å‡ºæ­¸é›¶ã€ã€‚</li>
                    <li>æ‰€æœ‰å¨›æ¨‚ã€è³¼ç‰©ã€å­¸ç¿’ã€é›œæ”¯æœƒè®Šæˆ 0ã€‚</li>
                    <li>é©åˆæ¨¡æ“¬ã€Œå…¨åŠ›è¡åˆº 7 å¹´ã€çš„ç‹€æ³ã€‚</li>
                </ol>
            </div>

            <h3 style="color:#111827; margin:25px 0 10px 0;">ğŸ“ ç­–ç•¥å‚™å¿˜éŒ„ï¼ˆå¯«çµ¦ 7 å¹´å¾Œçš„è‡ªå·±ï¼‰</h3>
            <p style="color:#4b5563; font-size:0.95em; margin-bottom:8px;">
                å»ºè­°å¯«ä¸‹ï¼šé‚„æ¬¾é †åºã€åŠ ç¢¼åŸå‰‡ã€ä»€éº¼æƒ…æ³è¦æ¸›æ§“æ¡¿ã€ä½•æ™‚è¦ä¼‘æ¯ä¸æ“ä½œâ€¦ é€™ä¸€å€ä¹Ÿæœƒè·Ÿè‘—ä¸€èµ·è¢«ã€ŒğŸ’¾ å„²å­˜æ•¸æ“šã€ä¿å­˜ã€‚
            </p>
            <textarea id="strategy_notes" placeholder="ä¾‹ï¼š
- æœªä¾† 2 å¹´å„ªå…ˆå„Ÿé‚„ B ä¿å–®å€Ÿæ¬¾ï¼Œæ¯æœˆå¾é…æ¯æŒª 1ï½2 è¬ã€‚
- ETF è³ªæŠ¼ç¶­æŒå€Ÿæ¬¾æ¯”åœ¨ 50% ä»¥ä¸‹ï¼Œä¸å†å¾€ä¸ŠåŠ ã€‚
- è‹¥è‚¡å¸‚ä¸‹è·Œè¶…é 35%ï¼Œæš«åœåŠ æ§“æ¡¿ï¼Œåªç”¨ç¾é‡‘åˆ†æ‰¹è²·ã€‚
- æ¯å¹´å›ºå®šæª¢è¦–ä¸€æ¬¡æ•´é«”æ§“æ¡¿ç‡èˆ‡å®‰å…¨åˆ†æ•¸ã€‚"></textarea>
        </div>
    </div>

    <script>
        // å®‰å…¨æ›´æ–°å…ƒç´ å…§å®¹çš„è¼”åŠ©å‡½æ•¸
        function safeSetText(elementId, value) {
            const element = document.getElementById(elementId);
            if (element !== null) {
                element.textContent = value;
            } else {
                console.warn(`å…ƒç´  ${elementId} ä¸å­˜åœ¨`);
            }
        }

        function safeSetStyle(elementId, property, value) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style[property] = value;
            } else {
                console.warn(`å…ƒç´  ${elementId} ä¸å­˜åœ¨`);
            }
        }

        function safeSetHTML(elementId, value) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = value;
            } else {
                console.warn(`å…ƒç´  ${elementId} ä¸å­˜åœ¨`);
            }
        }

        // å€Ÿæ¬¾æ¯”é¡è‰² class
        function getRatioColorClass(ratio) {
            if (ratio < 40) return 'ratio-green';
            if (ratio < 60) return 'ratio-yellowgreen';
            if (ratio < 80) return 'ratio-yellow';
            if (ratio < 90) return 'ratio-orange';
            return 'ratio-red';
        }

        // è¨ˆç®—å€Ÿæ¬¾æ¯”å’Œè·ŒæŠ—è·é›¢
        function calculateLeverageInfo(asset, loan, marginCall, liquidation) {
            const ratio = asset > 0 ? (loan / asset * 100) : 0;
            const marginCallDropPct = ratio > 0 ? ((1 - ratio / marginCall) * 100) : 100;
            const liquidationDropPct = ratio > 0 ? ((1 - ratio / liquidation) * 100) : 100;
            
            let status = 'safe';
            if (ratio >= 80) {
                status = 'danger';
            } else if (ratio >= 60) {
                status = 'warning';
            }
            
            return {
                ratio: ratio,
                marginCallDropPct: marginCallDropPct,
                liquidationDropPct: liquidationDropPct,
                status: status
            };
        }

        // æ›´æ–°é€²åº¦æ¢å’Œè·ŒæŠ—ä¿¡æ¯
        function updateProgressBar(id, info, marginCall, liquidation) {
            // æ›´æ–°å€Ÿæ¬¾æ¯”é¡¯ç¤º
            safeSetText('ratio_' + id, info.ratio.toFixed(1) + '%');
            
            // æ›´æ–°é€²åº¦æ¢
            const progressBar = document.getElementById('progress_' + id);
            if (progressBar) {
                const colorClass = getRatioColorClass(info.ratio);
                progressBar.style.width = Math.min(info.ratio, 100) + '%';
                progressBar.textContent = info.ratio.toFixed(1) + '%';
                progressBar.className = 'progress-bar-fill ' + colorClass;
            }
            
            // æ›´æ–°è·ŒæŠ—ä¿¡æ¯
            const marginDiv = document.getElementById('margin_' + id);
            if (!marginDiv) return;
            
            marginDiv.className = 'margin-info ' + info.status;
            
            let statusIcon = 'ğŸ›¡ï¸';
            let statusText = '';
            if (info.status === 'danger') {
                statusIcon = 'ğŸš¨';
                statusText = 'ã€å±éšªï¼æ¥è¿‘æˆ–è¶…éè£œç¹³ç·šã€‘';
            } else if (info.status === 'warning') {
                statusIcon = 'âš ï¸';
                statusText = 'ã€è­¦æˆ’ï¼å»ºè­°é™ä½å€Ÿæ¬¾æ¯”ã€‘';
            }
            
            // ç‰¹æ®Šè™•ç†ETFï¼ˆæœ‰145%è­¦ç¤ºç·šå’Œ130%è¿½ç¹³ç·šï¼‰
            if (id === 'etf') {
                const maintRatio = (info.ratio > 0) ? (100 / info.ratio * 100).toFixed(0) : 999;
                let maintStatus = '';
                if (maintRatio >= 145) {
                    maintStatus = 'ï¼ˆâœ… å®‰å…¨ï¼‰';
                } else if (maintRatio >= 130) {
                    maintStatus = 'ï¼ˆğŸ’› æ¥è¿‘è­¦ç¤ºç·š145%ï¼‰';
                } else {
                    maintStatus = 'ï¼ˆğŸš¨ ä½æ–¼è¿½ç¹³ç·š130%ï¼ï¼‰';
                }
                
                marginDiv.innerHTML = `
                    <strong>${statusIcon} è·ŒæŠ—è·é›¢</strong> ${statusText}<br>
                    â€¢ è³‡ç”¢å¯ä¸‹è·Œ <strong>${info.marginCallDropPct.toFixed(1)}%</strong> åˆ°è­¦ç¤ºç·šï¼ˆ145%ç¶­æŒç‡/å€Ÿæ¬¾æ¯”69%ï¼‰<br>
                    â€¢ è³‡ç”¢å¯ä¸‹è·Œ <strong>${info.liquidationDropPct.toFixed(1)}%</strong> åˆ°è¿½ç¹³ç·šï¼ˆ130%ç¶­æŒç‡/å€Ÿæ¬¾æ¯”77%ï¼‰<br>
                    ç•¶å‰ç¶­æŒç‡ï¼š<strong>${maintRatio}%</strong> ${maintStatus}<br>
                    <small style="color: #666;">â€» ä½æ–¼130%æœƒæ”¶åˆ°è¿½ç¹³é€šçŸ¥ï¼Œ2å€‹äº¤æ˜“æ—¥å…§å¿…é ˆè£œç¹³</small>
                `;
            } else {
                marginDiv.innerHTML = `
                    <strong>${statusIcon} è·ŒæŠ—è·é›¢</strong> ${statusText}<br>
                    è³‡ç”¢å¯ä¸‹è·Œ <strong>${info.marginCallDropPct.toFixed(1)}%</strong> æ‰åˆ°è£œç¹³ç·š<br>
                    å¯ä¸‹è·Œ <strong>${info.liquidationDropPct.toFixed(1)}%</strong> æ‰åˆ°æ–·é ­ç·š
                `;
            }
        }

        // è‚¡ç½æ¨¡æ“¬ï¼šè·Œ 30% / 40% å¾Œçš„å€Ÿæ¬¾æ¯”
        function updateDisasterSim(idPrefix, asset, loan) {
            const el30 = document.getElementById('disaster30_' + idPrefix);
            const el40 = document.getElementById('disaster40_' + idPrefix);
            if (!el30 || !el40) return;

            if (asset <= 0) {
                el30.textContent = 'â€”';
                el40.textContent = 'â€”';
                return;
            }

            const asset30 = asset * 0.7;
            const asset40 = asset * 0.6;
            const ratio30 = loan / asset30 * 100;
            const ratio40 = loan / asset40 * 100;

            el30.textContent = ratio30.toFixed(1);
            el40.textContent = ratio40.toFixed(1);
        }

        // è‡ªè¨‚è·Œå¹…æ¨¡æ“¬
        function updateCustomDisasterSim(idPrefix, asset, loan, dropPct) {
            const el = document.getElementById('disasterCustom_' + idPrefix);
            const labelEl = document.getElementById('disaster_custom_label_' + idPrefix);
            if (!el || !labelEl) return;

            labelEl.textContent = dropPct.toFixed(0);

            if (asset <= 0 || dropPct <= 0) {
                el.textContent = 'â€”';
                return;
            }

            const newAsset = asset * (1 - dropPct / 100);
            const ratio = loan / newAsset * 100;
            el.textContent = ratio.toFixed(1);
        }

        // å½ˆæ€§æ”¯å‡ºä¸€éµæ­¸é›¶
        function resetFlexible() {
            const ids = ['expense_entertainment', 'expense_shopping', 'expense_learning', 'expense_other'];
            ids.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.value = 0;
            });
            calculateAll();
        }

        // è¨ˆç®—æ‰€æœ‰æ•¸æ“š
        function calculateAll() {
            try {
                // è®€å–æ‰€æœ‰è³‡ç”¢
                const assetPolicyA = parseFloat(document.getElementById('asset_policy_a').value) || 0;
                const assetPolicyB = parseFloat(document.getElementById('asset_policy_b').value) || 0;
                const assetPolicyC = parseFloat(document.getElementById('asset_policy_c').value) || 0;
                const assetPolicyD = parseFloat(document.getElementById('asset_policy_d').value) || 0;
                const assetETF = parseFloat(document.getElementById('asset_etf').value) || 0;
                const assetCash = parseFloat(document.getElementById('asset_cash').value) || 0;

                // è®€å–æ‰€æœ‰è² å‚µ
                const loanPolicyA = parseFloat(document.getElementById('loan_policy_a').value) || 0;
                const loanPolicyB = parseFloat(document.getElementById('loan_policy_b').value) || 0;
                const loanPolicyC = parseFloat(document.getElementById('loan_policy_c').value) || 0;
                const loanPolicyD = parseFloat(document.getElementById('loan_policy_d').value) || 0;
                const loanETF = parseFloat(document.getElementById('loan_etf').value) || 0;
                const loanCredit = parseFloat(document.getElementById('loan_credit').value) || 0;
                const loanMortgage = parseFloat(document.getElementById('loan_mortgage').value) || 0;

                const totalPolicyLoan = loanPolicyA + loanPolicyB + loanPolicyC + loanPolicyD;

                // è¨ˆç®—ä¸¦æ›´æ–°ä¿å–®ABCçš„å€Ÿæ¬¾æ¯”å’Œè·ŒæŠ—è·é›¢ï¼ˆ80%è£œç¹³ï¼Œ90%æ–·é ­ï¼‰
                const infoA = calculateLeverageInfo(assetPolicyA, loanPolicyA, 80, 90);
                updateProgressBar('policy_a', infoA, 80, 90);
                
                const infoB = calculateLeverageInfo(assetPolicyB, loanPolicyB, 80, 90);
                updateProgressBar('policy_b', infoB, 80, 90);
                
                const infoC = calculateLeverageInfo(assetPolicyC, loanPolicyC, 80, 90);
                updateProgressBar('policy_c', infoC, 80, 90);
                
                // ä¿å–®Dï¼ˆ60%è£œç¹³ï¼Œ70%æ–·é ­ï¼‰
                const infoD = calculateLeverageInfo(assetPolicyD, loanPolicyD, 60, 70);
                updateProgressBar('policy_d', infoD, 60, 70);
                
                // ETFï¼ˆå€Ÿæ¬¾æ¯” 68.97% & 76.9% å°æ‡‰ç¶­æŒç‡ 145/130ï¼‰
                const infoETF = calculateLeverageInfo(assetETF, loanETF, 68.97, 76.9);
                updateProgressBar('etf', infoETF, 68.97, 76.9);

                // è‚¡ç½æ¨¡æ“¬å›ºå®š -30% / -40%
                updateDisasterSim('policy_a', assetPolicyA, loanPolicyA);
                updateDisasterSim('policy_b', assetPolicyB, loanPolicyB);
                updateDisasterSim('policy_c', assetPolicyC, loanPolicyC);
                updateDisasterSim('policy_d', assetPolicyD, loanPolicyD);
                updateDisasterSim('etf', assetETF, loanETF);

                // è‡ªè¨‚è·Œå¹…æ»‘æ¡¿
                const sliderEl = document.getElementById('disaster_slider');
                let sliderDrop = 30;
                if (sliderEl) {
                    sliderDrop = parseFloat(sliderEl.value) || 0;
                }
                safeSetText('disaster_slider_value', sliderDrop.toFixed(0));
                updateCustomDisasterSim('policy_a', assetPolicyA, loanPolicyA, sliderDrop);
                updateCustomDisasterSim('policy_b', assetPolicyB, loanPolicyB, sliderDrop);
                updateCustomDisasterSim('policy_c', assetPolicyC, loanPolicyC, sliderDrop);
                updateCustomDisasterSim('policy_d', assetPolicyD, loanPolicyD, sliderDrop);
                updateCustomDisasterSim('etf', assetETF, loanETF, sliderDrop);

                // è‚¡ç¥¨è³ªæŠ¼æœ€ä½è£œç¹³è©¦ç®—
                const targetRatioETF = parseFloat(document.getElementById('target_ratio_etf').value) || 0;
                let minRepay = 0;
                if (assetETF > 0 && targetRatioETF > 0) {
                    const maxLoanAllowed = assetETF * (targetRatioETF / 100);
                    minRepay = loanETF - maxLoanAllowed;
                    if (minRepay < 0) minRepay = 0;
                }
                safeSetText('etf_min_repay', minRepay.toFixed(1));

                // è¨ˆç®—ç¸½è³‡ç”¢èˆ‡è² å‚µ
                const totalAssets = assetPolicyA + assetPolicyB + assetPolicyC + assetPolicyD + assetETF + assetCash;
                const totalLiabilities = loanPolicyA + loanPolicyB + loanPolicyC + loanPolicyD + 
                                        loanETF + loanCredit + loanMortgage;
                const netAssets = totalAssets - totalLiabilities;
                const leverageRatio = totalAssets > 0 ? (totalLiabilities / totalAssets * 100).toFixed(1) : 0;

                safeSetText('total_assets', totalAssets.toFixed(0));
                safeSetText('total_liabilities', totalLiabilities.toFixed(0));
                safeSetText('net_assets', netAssets.toFixed(0));
                safeSetText('leverage_ratio', leverageRatio);

                // è¨ˆç®—å¯å‹•ç”¨ç¾é‡‘
                const totalAvailableCash = assetCash + 50 + 36;
                safeSetText('total_available_cash', totalAvailableCash.toFixed(0));

                // è®€å–æ”¶å…¥
                const incomeActive = parseFloat(document.getElementById('income_active').value) || 0;
                const incomePassive = parseFloat(document.getElementById('income_passive').value) || 0;
                const totalIncome = incomeActive + incomePassive;

                // è®€å–å›ºå®šæ”¯å‡º
                const expenseMortgage = parseFloat(document.getElementById('expense_mortgage').value) || 0;
                const expenseCredit = parseFloat(document.getElementById('expense_credit').value) || 0;
                const expenseLiving = parseFloat(document.getElementById('expense_living').value) || 0;
                const expenseInsurance = parseFloat(document.getElementById('expense_insurance').value) || 0;
                const expenseCommunication = parseFloat(document.getElementById('expense_communication').value) || 0;
                const expenseHealth = parseFloat(document.getElementById('expense_health').value) || 0;
                const totalFixedExpense = expenseMortgage + expenseCredit + expenseLiving + expenseInsurance + 
                                        expenseCommunication + expenseHealth;

                // è®€å–å½ˆæ€§æ”¯å‡º
                const expenseEntertainment = parseFloat(document.getElementById('expense_entertainment').value) || 0;
                const expenseShopping = parseFloat(document.getElementById('expense_shopping').value) || 0;
                const expenseLearning = parseFloat(document.getElementById('expense_learning').value) || 0;
                const expenseOther = parseFloat(document.getElementById('expense_other').value) || 0;
                const totalFlexibleExpense = expenseEntertainment + expenseShopping + expenseLearning + expenseOther;

                // è¨ˆç®—åˆ©æ¯ï¼ˆä¿å–®åˆ©æ¯å’ŒETFåˆ©æ¯éƒ½å¯ç·¨è¼¯ï¼‰
                const interestPolicyAuto = Math.max(0, Math.round(totalPolicyLoan * 10000 * 0.04 / 12));
                const interestETFAuto = Math.max(0, Math.round(loanETF * 10000 * 0.03 / 12));
                
                // è®€å–ç”¨æˆ¶è¼¸å…¥çš„åˆ©æ¯å€¼
                const interestPolicyInputElement = document.getElementById('interest_policy_input');
                const interestETFInputElement = document.getElementById('interest_etf_input');
                
                let interestPolicyInput = parseFloat(interestPolicyInputElement.value);
                if (!interestPolicyInput || isNaN(interestPolicyInput) || interestPolicyInput < 0) {
                    interestPolicyInput = interestPolicyAuto;
                    interestPolicyInputElement.value = interestPolicyAuto;
                }
                
                let interestETFInput = parseFloat(interestETFInputElement.value);
                if (!interestETFInput || isNaN(interestETFInput) || interestETFInput < 0) {
                    interestETFInput = interestETFAuto;
                    interestETFInputElement.value = interestETFAuto;
                }
                
                const totalInterest = interestPolicyInput + interestETFInput;

                // æ›´æ–°é¡¯ç¤º
                safeSetText('total_income', totalIncome.toLocaleString());
                safeSetText('display_total_income', totalIncome.toLocaleString());
                
                safeSetText('total_fixed_expense', totalFixedExpense.toLocaleString());
                safeSetText('total_flexible_expense', totalFlexibleExpense.toLocaleString());
                
                safeSetText('interest_policy_auto', interestPolicyAuto.toLocaleString());
                safeSetText('interest_etf_auto', interestETFAuto.toLocaleString());
                safeSetText('total_interest', totalInterest.toLocaleString());

                safeSetText('display_policy_loan', totalPolicyLoan.toFixed(1));
                safeSetText('display_etf_loan', loanETF.toFixed(1));

                // è¨ˆç®—ç¸½æ”¯å‡ºå’Œç›ˆé¤˜
                const totalExpense = totalFixedExpense + totalFlexibleExpense + totalInterest;
                const monthlySurplus = totalIncome - totalExpense;
                const savingRate = totalIncome > 0 ? (monthlySurplus / totalIncome * 100).toFixed(1) : 0;
                const annualInvestment = monthlySurplus * 12;

                safeSetText('display_total_expense', totalExpense.toLocaleString());
                safeSetText('monthly_surplus', monthlySurplus.toLocaleString());
                safeSetText('saving_rate', savingRate);
                safeSetText('annual_investment', annualInvestment.toLocaleString());

                // æ›´æ–°é…æ¯é€²åº¦ï¼ˆç›®å‰ï¼‰
                const passiveIncome = incomePassive / 10000; // è¬
                const completionRate = (passiveIncome / 7 * 100).toFixed(0);

                safeSetText('display_passive_income', passiveIncome.toFixed(1));
                safeSetText('progress_percentage', completionRate);
                safeSetText('progress_text', passiveIncome.toFixed(1) + 'è¬ / 7è¬');
                safeSetStyle('progress_bar', 'width', completionRate + '%');

                const progressBar = document.getElementById('progress_bar');
                if (progressBar) {
                    const p = parseFloat(completionRate);
                    if (p >= 100) {
                        progressBar.style.background = 'linear-gradient(90deg, #10b981, #059669)';
                    } else if (p >= 80) {
                        progressBar.style.background = 'linear-gradient(90deg, #10b981, #059669)';
                    } else if (p >= 60) {
                        progressBar.style.background = 'linear-gradient(90deg, #f59e0b, #d97706)';
                    } else {
                        progressBar.style.background = 'linear-gradient(90deg, #ef4444, #dc2626)';
                    }
                }

                // ===== æ¯å¼µä¿å–®ã€Œè‡ªå„Ÿæ¯”ã€ & ç¾é‡‘æµè²¢ç» =====
                const policyAssets = [assetPolicyA, assetPolicyB, assetPolicyC, assetPolicyD];
                const policyLoans = [loanPolicyA, loanPolicyB, loanPolicyC, loanPolicyD];
                const policyIds = ['policy_a', 'policy_b', 'policy_c', 'policy_d'];
                const totalPolicyAssets = policyAssets.reduce((a,b)=>a+b,0);

                const totalPolicyInterestInput = interestPolicyInput; // å…¨éƒ¨ä¿å–®åˆ©æ¯
                for (let i = 0; i < policyIds.length; i++) {
                    const id = policyIds[i];
                    const aVal = policyAssets[i];
                    const lVal = policyLoans[i];

                    let incomeShare = 0;
                    let interestShare = 0;

                    if (totalPolicyAssets > 0) {
                        incomeShare = incomePassive * (aVal / totalPolicyAssets); // è©²ä¿å–®ä¼°è¨ˆæœˆé…æ¯
                    }
                    if (totalPolicyLoan > 0 && totalPolicyInterestInput > 0) {
                        interestShare = totalPolicyInterestInput * (lVal / totalPolicyLoan); // è©²ä¿å–®ä¼°è¨ˆæœˆåˆ©æ¯
                    }

                    let selfRepText = 'â€”';
                    if (interestShare > 1) {
                        const ratio = incomeShare / interestShare;
                        selfRepText = ratio.toFixed(1) + ' å€';
                    } else if (lVal > 0 && interestShare <= 1 && incomeShare > 0) {
                        selfRepText = 'âˆï¼ˆå¹¾ä¹ä¸åƒåˆ©æ¯ï¼‰';
                    } else if (lVal === 0) {
                        selfRepText = 'â€”ï¼ˆç„¡å€Ÿæ¬¾ï¼‰';
                    }

                    const netCashflow = incomeShare - interestShare;
                    safeSetText('selfrep_' + id, selfRepText);
                    safeSetText('cashflow_' + id, netCashflow.toFixed(0));
                }

                // ===== 7å¹´å„²è“„ï¼ˆ5%ï¼‰â†’ 8%é…æ¯è©¦ç®— =====
                const yearlyInvestment = monthlySurplus > 0 ? monthlySurplus * 12 : 0;
                const years = 7;
                const r_save = 0.05; // å„²è“„æœŸå¹´åŒ–5%

                let futureValueSaving = 0;
                if (yearlyInvestment > 0) {
                    futureValueSaving = yearlyInvestment * (Math.pow(1 + r_save, years) - 1) / r_save;
                }

                // 7å¹´å¾ŒæŠŠé€™ä¸€åŒ…éŒ¢è½‰å…¥8%é…æ¯å‹åŸºé‡‘
                const r_yield = 0.08;
                const newMonthlyIncome = futureValueSaving * r_yield / 12; // å…ƒ/æœˆ
                const totalMonthlyPassive45 = incomePassive + newMonthlyIncome;

                // é¡¯ç¤ºç‚ºã€Œè¬ã€
                const annualInvWan = (yearlyInvestment / 10000).toFixed(1);
                const sevenYearInv = (yearlyInvestment * years / 10000).toFixed(1);
                const fvWan = (futureValueSaving / 10000).toFixed(1);
                const newMonthlyIncomeWan = (newMonthlyIncome / 10000).toFixed(1);
                const totalMonthlyPassiveWan = (totalMonthlyPassive45 / 10000).toFixed(1);

                safeSetText('display_annual_inv', annualInvWan);
                safeSetText('seven_year_inv', sevenYearInv);
                safeSetText('estimated_networth_45', fvWan);
                safeSetText('estimated_income_45', newMonthlyIncomeWan);
                safeSetText('estimated_total_passive_45', totalMonthlyPassiveWan);

                // é”æ¨™é æ¸¬æ–‡å­—
                let targetPred = '';
                const totalPassive = totalMonthlyPassive45 / 10000; // è¬
                if (yearlyInvestment <= 0) {
                    targetPred = 'ç›®å‰æœˆç›ˆé¤˜ç‚ºè² æˆ–æ¥è¿‘ 0ï¼Œ7 å¹´å¾Œç„¡æ³•é¡å¤–ç´¯ç©å¯è§€è³‡ç”¢ï¼Œå»ºè­°å„ªå…ˆèª¿æ•´æ”¶æ”¯çµæ§‹ï¼ˆæé«˜æœˆç›ˆé¤˜ï¼‰å†è«‡ 7 å¹´è¨ˆç•«ã€‚';
                } else {
                    if (totalPassive >= 7) {
                        targetPred = `ä»¥ç›®å‰æœˆç›ˆé¤˜ç´„ <strong>${(monthlySurplus/10000).toFixed(1)} è¬</strong> è¨ˆç®—ï¼Œæ¡ç”¨ã€Œ<strong>å„²è“„æœŸ5%</strong> + <strong>é…æ¯æœŸ8%</strong>ã€çš„ä¿å®ˆæ¨¡å‹ï¼š<br>
                        â€¢ 7 å¹´å¾Œæ–°å¢æœˆé…æ¯ç´„ <strong>${newMonthlyIncomeWan} è¬</strong><br>
                        â€¢ 45 æ­²ç¸½æœˆé…æ¯ç´„ <strong>${totalMonthlyPassiveWan} è¬</strong>ï¼ˆå«ç¾åœ¨çš„è¢«å‹•æ”¶å…¥ï¼‰<br>
                        â€¢ ä»¥ 7 è¬/æœˆç›®æ¨™ä¾†çœ‹ï¼Œ<strong>45 æ­²é”æ¨™æ©Ÿç‡éå¸¸é«˜ï¼ˆç´„ 80â€“90%ï¼‰</strong>ï¼Œå‰ææ˜¯èƒ½æŒçºŒç¶­æŒç¾åœ¨çš„å„²è“„ç´€å¾‹ã€‚`;
                    } else if (totalPassive >= 6) {
                        targetPred = `ä»¥ç›®å‰æœˆç›ˆé¤˜ç´„ <strong>${(monthlySurplus/10000).toFixed(1)} è¬</strong> è¨ˆç®—ï¼š<br>
                        â€¢ 7 å¹´å¾Œæ–°å¢æœˆé…æ¯ç´„ <strong>${newMonthlyIncomeWan} è¬</strong><br>
                        â€¢ 45 æ­²ç¸½æœˆé…æ¯ç´„ <strong>${totalMonthlyPassiveWan} è¬</strong>ï¼ˆæ¥è¿‘ 7 è¬ç›®æ¨™ï¼‰<br>
                        â€¢ è‹¥èƒ½å†æŠŠæœˆç›ˆé¤˜æ‹‰é«˜åˆ° <strong>2.5ï½3 è¬</strong>ï¼Œ45 æ­²é”æ¨™æ©Ÿç‡å¯æœ›æå‡åˆ° <strong>70â€“80%</strong>ã€‚`;
                    } else {
                        targetPred = `ç›®å‰æœˆç›ˆé¤˜ç´„ <strong>${(monthlySurplus/10000).toFixed(1)} è¬</strong>ï¼Œè©¦ç®—çµæœï¼š<br>
                        â€¢ 7 å¹´å¾Œæ–°å¢æœˆé…æ¯ç´„ <strong>${newMonthlyIncomeWan} è¬</strong><br>
                        â€¢ 45 æ­²ç¸½æœˆé…æ¯ç´„ <strong>${totalMonthlyPassiveWan} è¬</strong>ï¼Œè·é›¢ 7 è¬ä»æœ‰è½å·®<br>
                        â€¢ å»ºè­°ï¼š<strong>å„ªå…ˆç›®æ¨™æ˜¯æŠŠæœˆç›ˆé¤˜æ‹‰é«˜åˆ° 2ï½2.5 è¬ä»¥ä¸Š</strong>ï¼ˆé–‹æº + ç¯€æµï¼‰ï¼Œå†æ­é… 7 å¹´ 5% â†’ 8% é…æ¯ç­–ç•¥ï¼Œæœƒæ›´æ¥è¿‘ç›®æ¨™ã€‚`;
                    }
                }
                safeSetHTML('target_prediction', targetPred);

                // ===== ç›®æ¨™æœˆé…æ¯ â†’ åæ¨éœ€è¦è³‡ç”¢ & å ±é…¬ç‡ =====
                const targetMonthly = parseFloat(document.getElementById('target_monthly_income').value) || 70000;
                const targetYieldPct = parseFloat(document.getElementById('target_yield').value) || 8;
                const targetYield = targetYieldPct / 100;

                let requiredCapital = 0;
                if (targetYield > 0) {
                    requiredCapital = targetMonthly * 12 / targetYield; // å…ƒ
                }

                const financialAssetsWan = assetPolicyA + assetPolicyB + assetPolicyC + assetPolicyD + assetETF;
                const financialAssetsNTD = financialAssetsWan * 10000;
                const capitalGap = requiredCapital - financialAssetsNTD;

                safeSetText('required_capital', (requiredCapital / 10000).toFixed(1));
                safeSetText('current_capital', (financialAssetsNTD / 10000).toFixed(1));
                safeSetText('capital_gap', (capitalGap / 10000).toFixed(1));

                let capitalComment = '';
                if (targetMonthly <= 0 || targetYield <= 0) {
                    capitalComment = 'è«‹è¼¸å…¥åˆç†çš„ã€Œç›®æ¨™æœˆé…æ¯ã€èˆ‡ã€Œé æœŸé…æ¯ç‡ã€ï¼Œç³»çµ±æœƒå¹«ä½ ä¼°ç®—é”æ¨™æ‰€éœ€çš„é…æ¯è³‡æœ¬ã€‚';
                } else {
                    if (capitalGap <= 0) {
                        capitalComment = `ä»¥ç›®æ¨™æœˆé…æ¯ <strong>${(targetMonthly/10000).toFixed(2)} è¬</strong>ã€é…æ¯ç‡ <strong>${targetYieldPct.toFixed(1)}%</strong> è¨ˆç®—ï¼š<br>
                        â€¢ ç†è«–ä¸Šæ‰€éœ€é…æ¯è³‡æœ¬ç´„ <strong>${(requiredCapital/10000).toFixed(1)} è¬</strong><br>
                        â€¢ ä½ ç›®å‰ä¿å–®+ETF è¦æ¨¡ç´„ <strong>${(financialAssetsNTD/10000).toFixed(1)} è¬</strong>ï¼Œ<strong>å·²ç¶“è¶³ä»¥æ”¯æ’é€™å€‹ç›®æ¨™</strong>ï¼ˆç”šè‡³ç•¥æœ‰è¶…éï¼‰<br>
                        â€¢ å¾ŒçºŒé‡é»åœ¨æ–¼ï¼š<strong>èª¿æ•´è³‡ç”¢çµæ§‹ â†’ æå‡æ•´é«”é…æ¯ç‡ & ç©©å®šåº¦</strong>ã€‚`;
                    } else {
                        capitalComment = `ä»¥ç›®æ¨™æœˆé…æ¯ <strong>${(targetMonthly/10000).toFixed(2)} è¬</strong>ã€é…æ¯ç‡ <strong>${targetYieldPct.toFixed(1)}%</strong> è¨ˆç®—ï¼š<br>
                        â€¢ é”æ¨™æ‰€éœ€é…æ¯è³‡æœ¬ç´„ <strong>${(requiredCapital/10000).toFixed(1)} è¬</strong><br>
                        â€¢ ç›®å‰ä¿å–®+ETF è¦æ¨¡ç´„ <strong>${(financialAssetsNTD/10000).toFixed(1)} è¬</strong><br>
                        â€¢ è³‡æœ¬ç¼ºå£ç´„ <strong>${(capitalGap/10000).toFixed(1)} è¬</strong>ï¼Œå¯é€éï¼š<br>
                        &nbsp;&nbsp;â‘  æŒçºŒä»¥æœˆç›ˆé¤˜å®šæœŸå®šé¡ç´¯ç©<br>
                        &nbsp;&nbsp;â‘¡ é©åº¦èª¿æ•´é…æ¯ç‡ï¼ˆå¦‚ 7ï½8%ï¼‰<br>
                        &nbsp;&nbsp;â‘¢ è¦åŠƒ 7 å¹´åˆ†æ®µé”æ¨™ï¼ˆä¾‹å¦‚å…ˆé” 6 è¬ï¼Œå†å¾€ 7 è¬è¡ï¼‰ã€‚`;
                    }
                }
                safeSetHTML('capital_comment', capitalComment);

                // ===== æ§“æ¡¿å®‰å…¨é›·é” / ç¸½é«”è©•åˆ† =====
                const avgPolicyRatio = (infoA.ratio + infoB.ratio + infoC.ratio + infoD.ratio) / 4;
                const cashMonths = totalExpense > 0 ? (assetCash * 10000 / totalExpense) : 99;

                let safetyScore = 100;
                const lev = parseFloat(leverageRatio) || 0;

                if (lev > 30) safetyScore -= (lev - 30) * 0.7;
                if (avgPolicyRatio > 40) safetyScore -= (avgPolicyRatio - 40) * 0.5;

                if (cashMonths >= 12) {
                    safetyScore += 10;
                } else if (cashMonths >= 6) {
                    safetyScore += 5;
                } else if (cashMonths < 3) {
                    safetyScore -= 5;
                }

                if (safetyScore > 100) safetyScore = 100;
                if (safetyScore < 0) safetyScore = 0;

                safeSetText('safety_score', safetyScore.toFixed(0));
                safeSetText('safety_leverage', leverageRatio);
                safeSetText('safety_policy_ratio', avgPolicyRatio.toFixed(1));
                safeSetText('safety_cash_months', cashMonths.toFixed(1));

                let level = '';
                let comment = '';
                let badgeColor = '';
                let badgeBg = '';

                if (safetyScore >= 85) {
                    level = 'ğŸŸ¢ éå¸¸å®‰å…¨';
                    comment = 'æ•´é«”æ§“æ¡¿åä½ã€ä¿å–®å€Ÿæ¬¾æ¯”å¥åº·ã€ç¾é‡‘ç·©è¡å……è¶³ï¼Œå°±ç®—å†ä¾†ä¸€æ¬¡ 2008 ç´šåˆ¥çš„å¤§è·Œä¹Ÿæœ‰ç›¸ç•¶å¤§çš„ç·©è¡ç©ºé–“ã€‚å¯ä»¥å°ˆå¿ƒåšå¥½è³‡ç”¢é…ç½®èˆ‡ç”Ÿæ´»å“è³ªã€‚';
                    badgeBg = '#dcfce7'; badgeColor = '#166534';
                } else if (safetyScore >= 70) {
                    level = 'ğŸŸ¢ åå®‰å…¨';
                    comment = 'çµæ§‹æ•´é«”ç©©å¥ï¼Œå¯ä»¥æ‰¿å—å¤§å‹ä¿®æ­£ã€‚ä»ç„¶å»ºè­°é•·æœŸç›®æ¨™æ˜¯ã€Œæ…¢æ…¢é™æ§“æ¡¿ã€ï¼Œä¾‹å¦‚ï¼šæ¯å¹´æŠŠä¿å–®å€Ÿæ¬¾æ¯”å¾€ä¸‹å£“ 3ï½5 å€‹ç™¾åˆ†é»ã€‚';
                    badgeBg = '#ecfdf5'; badgeColor = '#15803d';
                } else if (safetyScore >= 55) {
                    level = 'ğŸŸ¡ ä¸­æ€§';
                    comment = 'ç›®å‰çµæ§‹ä¸ç®—å±éšªï¼Œä½†é‡åˆ° 30ï½40% ç­‰ç´šè‚¡ç½æ™‚ï¼Œå¿ƒç†å£“åŠ›æœƒåå¤§ã€‚å»ºè­°æ’ä¸€å€‹ 3 å¹´å·¦å³çš„é™æ§“æ¡¿è¨ˆç•«ï¼Œæ…¢æ…¢æŠŠå€Ÿæ¬¾æ¯”é™åˆ°æ›´èˆ’æœçš„ä½ç½®ã€‚';
                    badgeBg = '#fef9c3'; badgeColor = '#854d0e';
                } else if (safetyScore >= 40) {
                    level = 'ğŸŸ  åç·Šç¹ƒ';
                    comment = 'è‹¥é‡åˆ° 30% ä»¥ä¸Šçš„å¤§è·Œï¼Œéƒ¨åˆ†è³‡ç”¢å¯èƒ½é€¼è¿‘è£œç¹³ç·šï¼Œéœ€è¦ç›¸ç•¶ç©©å®šçš„å¿ƒæ…‹èˆ‡ç¾é‡‘ç®¡ç†ã€‚å»ºè­°å„ªå…ˆèª¿æ•´ï¼šâ‘  é‚„éƒ¨åˆ†ä¿å–®å€Ÿæ¬¾ â‘¡ é™ä½è³ªæŠ¼æ¯”ä¾‹ã€‚';
                    badgeBg = '#ffedd5'; badgeColor = '#9a3412';
                } else {
                    level = 'ğŸ”´ é¢¨éšªéé«˜';
                    comment = 'ç›®å‰æ§“æ¡¿å£“åŠ›åå¤§ï¼Œä¸€æ—¦å¸‚å ´å‡ºç¾åŠ‡çƒˆä¿®æ­£ï¼Œå¯èƒ½æœƒåŒæ™‚é¢è‡¨ç¾é‡‘æµèˆ‡è¿½ç¹³å£“åŠ›ã€‚å»ºè­°æŠŠã€Œé‚„æ¬¾ã€ç•¶æˆæœªä¾† 1ï½2 å¹´çš„é¦–è¦ä»»å‹™ï¼Œæš«ç·©æ‰€æœ‰åŠ ç¢¼æ§“æ¡¿è¡Œç‚ºã€‚';
                    badgeBg = '#fee2e2'; badgeColor = '#991b1b';
                }

                const levelEl = document.getElementById('safety_level');
                if (levelEl) {
                    levelEl.textContent = level;
                    levelEl.style.backgroundColor = badgeBg;
                    levelEl.style.color = badgeColor;
                }
                safeSetHTML('safety_comment', comment);

            } catch (error) {
                console.error('è¨ˆç®—éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤:', error);
                alert('âš ï¸ è¨ˆç®—æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥è¼¸å…¥çš„æ•¸å€¼æ˜¯å¦æ­£ç¢ºã€‚éŒ¯èª¤è©³æƒ…ï¼š' + error.message);
            }
        }

        // å„²å­˜æ•¸æ“šåˆ°æœ¬åœ°
        function saveData() {
            const data = {};
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                data[input.id] = input.value;
            });
            const notesEl = document.getElementById('strategy_notes');
            if (notesEl) {
                data['strategy_notes'] = notesEl.value;
            }
            localStorage.setItem('financialTrackerDataV2', JSON.stringify(data));
            alert('âœ… æ•¸æ“šå·²å„²å­˜ï¼');
        }

        // å¾æœ¬åœ°è¼‰å…¥æ•¸æ“š
        function loadData(silent) {
            silent = !!silent;
            try {
                const savedData = localStorage.getItem('financialTrackerDataV2');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    Object.keys(data).forEach(id => {
                        if (id === 'strategy_notes') return;
                        const element = document.getElementById(id);
                        if (element && element.type === 'number') {
                            element.value = data[id];
                        }
                    });
                    const notesEl = document.getElementById('strategy_notes');
                    if (notesEl && typeof data['strategy_notes'] === 'string') {
                        notesEl.value = data['strategy_notes'];
                    }
                    calculateAll();
                    if (!silent) alert('âœ… æ•¸æ“šå·²è¼‰å…¥ï¼');
                } else {
                    if (!silent) alert('âŒ æ²’æœ‰æ‰¾åˆ°å„²å­˜çš„æ•¸æ“š');
                    calculateAll();
                }
            } catch (error) {
                console.error('è¼‰å…¥æ•¸æ“šæ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                if (!silent) alert('âš ï¸ è¼‰å…¥æ•¸æ“šæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š' + error.message);
                calculateAll();
            }
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•è¼‰å…¥æ•¸æ“šå’Œè¨ˆç®—
        window.onload = function() {
            try {
                const savedData = localStorage.getItem('financialTrackerDataV2');
                if (savedData) {
                    loadData(true);
                } else {
                    calculateAll();
                }
            } catch (error) {
                console.error('é é¢åˆå§‹åŒ–æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                try {
                    calculateAll();
                } catch (e) {
                    console.error('åˆå§‹è¨ˆç®—å¤±æ•—:', e);
                }
            }
        };
    </script>
</body>
</html>
